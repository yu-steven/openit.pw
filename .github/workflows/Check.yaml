name: Check

on:
  schedule:
    - cron: '*/15 * * * *' #10åˆ†é’Ÿ
  workflow_dispatch: #æ‰‹åŠ¨è°ƒè¯•æŒ‰é’®

jobs:
  Check:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v3 #Git Clone
    - uses: actions/setup-node@v3 #Node.jsç¯å¢ƒ
      with:
        node-version: '16.x' #Node.js 16.x
    - name: ğŸ”§ Timezone #UTC+0 â†’ UTC+8
      run: sudo timedatectl set-timezone 'Asia/Shanghai'
    - name: ğŸ”§ Git #é…ç½®Gitçš„ä¸Šä¼ ç”¨æˆ·åå’Œé‚®ç®±
      run: |
        git config pull.rebase false
        git config --local user.name "GitHub Actions"
        git config --local user.email "actions@github.com"
    - name: ğŸ“¦ï¸ NPM #å®‰è£…npmåŒ…
      run: npm ci
    - name: ğŸ—‘ï¸ Delete #åˆ é™¤æ–‡ä»¶
      run: |
        cd ./web/public/
        rm -f ./https
        rm -f ./long
        rm -f ./Quanx.conf
        rm -f ./Clash.yaml
        rm -f ./_headers
    - name: ğŸ©º Check #æ£€æŸ¥openit.pwæ˜¯å¦æŒ‚äº†
      env: #è®¾ç½®ç¯å¢ƒå˜é‡
        CHECKLY_CHECK_ID: ${{ secrets.CHECKLY_CHECK_ID }}
        CHECKLY_ACCOUNT_ID: ${{ secrets.CHECKLY_ACCOUNT_ID }}
        CHECKLY_API_TOKEN: ${{ secrets.CHECKLY_API_TOKEN }}
      run: npm start
    - name: ğŸ”€ Git Push #Push
      run: |
        chmod +x ./.github/update-repo.sh
        ./.github/update-repo.sh || true